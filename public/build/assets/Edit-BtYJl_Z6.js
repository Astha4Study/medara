import{j as e,t as h,b as p,a as g,H as u,s as b}from"./app-DPU-5xaA.js";import{D as y}from"./data-pasien-resep-JMGFjLV3.js";import{A as j,b as f,c as N,d as v,e as w,f as D,g as k,h as R}from"./alert-dialog-C-ihqo6s.js";import{A as _}from"./app-layout-i-Fpipg8.js";import"./app-BZ19I5NX.js";import"./highlight-DUR8rx6z.js";import"./utils-C8uvsPt5.js";import"./index-BtRVbgEg.js";import"./app-logo-icon-xsYHPLvD.js";import"./x-DTHQ_Ru-.js";import"./index-4Ns3tNZl.js";const m=a=>a?new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(Number(a)):"Rp 0",P=a=>Number(a.replace(/[^0-9]/g,""));function S({detailResep:a,detailLayanan:l,data:s,setData:i,onSubmit:o,processing:x=!1}){const c=a.reduce((t,d)=>t+d.subtotal,0)+l.reduce((t,d)=>t+d.subtotal,0),r=s.uang_dibayar-c,n=t=>{if(t.preventDefault(),r<0){h.error("Uang pasien kurang",{description:`Kurang Rp ${Math.abs(r).toLocaleString("id-ID")}`});return}o()};return e.jsxs("form",{onSubmit:n,className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-800",children:"Kalkulator Pembayaran"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Harga"}),e.jsx("span",{className:"font-semibold",children:m(c)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Uang dari Pasien"}),e.jsx("input",{type:"text",value:m(s.uang_dibayar),onChange:t=>i("uang_dibayar",P(t.target.value)),className:"w-full rounded-md border px-3 py-2 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium",children:"Metode Pembayaran"}),e.jsxs("select",{value:s.metode_pembayaran,onChange:t=>i("metode_pembayaran",t.target.value),className:"w-full rounded-md border px-3 py-2 text-sm",children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"qris",children:"QRIS"}),e.jsx("option",{value:"transfer",children:"Transfer"})]})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:`text-sm font-medium ${r<0?"text-red-600":"text-emerald-600"}`,children:r<0?"Kurang":"Kembalian"}),e.jsx("span",{className:`font-semibold ${r<0?"text-red-600":"text-emerald-600"}`,children:m(Math.abs(r))})]})]}),e.jsx("div",{className:"flex justify-end rounded-b-xl border-t bg-gray-50 px-6 py-4",children:e.jsx("button",{type:"submit",disabled:x||r<0,className:"rounded-lg bg-emerald-600 px-4 py-2 text-sm text-white hover:bg-emerald-700 disabled:opacity-50",children:"Konfirmasi Pembayaran"})})]})}const I=({detail:a})=>{const l=a.reduce((s,i)=>s+i.subtotal,0);return e.jsxs("div",{className:"flex h-full flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Detail Layanan"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Daftar lengkap layanan beserta harga yang dibayarkan"})]}),e.jsx("div",{className:"flex-1 px-4 pb-4",children:e.jsx("div",{className:"overflow-hidden rounded-md border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Layanan"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Harga"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.nama}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-700",children:["Rp ",s.harga.toLocaleString("id-ID")]}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-gray-900",children:["Rp"," ",s.subtotal.toLocaleString("id-ID")]})]},s.id))})]})})}),e.jsx("div",{className:"mt-auto border-t border-gray-200 bg-gray-50 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:["Rp ",l.toLocaleString("id-ID")]})]})})]})},A=({detail:a})=>{const l=a.reduce((s,i)=>s+i.subtotal,0);return e.jsxs("div",{className:"flex h-full flex-col overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Detail Obat Resep"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Daftar lengkap obat beserta harga yang dibayarkan"})]}),e.jsx("div",{className:"flex-1 px-4 pb-4",children:e.jsx("div",{className:"overflow-hidden rounded-md border border-gray-200",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Obat"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Jumlah"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Harga Satuan"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium tracking-wider text-gray-600 uppercase",children:"Subtotal"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 bg-white",children:a.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 text-gray-900",children:s.nama}),e.jsxs("td",{className:"px-4 py-3 text-right text-gray-700",children:[s.jumlah," ",s.satuan?s.satuan:""]}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(s.harga)}),e.jsxs("td",{className:"px-4 py-3 text-right font-semibold text-gray-900",children:["Rp"," ",s.subtotal.toLocaleString("id-ID")]})]},s.id))})]})})}),e.jsx("div",{className:"mt-auto border-t border-gray-200 bg-gray-50 px-6 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsxs("span",{className:"text-lg font-bold text-emerald-600",children:["Rp ",l.toLocaleString("id-ID")]})]})})]})},L=[{title:"Pembayaran",href:"/resepsionis/pembayaran"},{title:"Proses Pembayaran",href:""}];function B({pembayaran:a}){const{data:l,setData:s,put:i,processing:o}=p({uang_dibayar:0,metode_pembayaran:"cash"}),[x,c]=g.useState(!1);a.detail_resep.reduce((n,t)=>n+t.subtotal,0)+a.detail_layanan.reduce((n,t)=>n+t.subtotal,0);const r=()=>{const n=a.detail_resep.reduce((t,d)=>t+d.subtotal,0)+a.detail_layanan.reduce((t,d)=>t+d.subtotal,0);i(b("resepsionis.pembayaran.update",a.id),{preserveScroll:!0,onSuccess:()=>{c(!1);const t=l.uang_dibayar-n;h.success("Pembayaran berhasil",{description:`Kembalian: Rp ${t.toLocaleString("id-ID")}`})},onError:()=>{h.error("Pembayaran gagal",{description:"Terjadi kesalahan saat memproses pembayaran."})}})};return e.jsxs(_,{breadcrumbs:L,children:[e.jsx(u,{title:"Proses Pembayaran"}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{pasien:a.pasien}),e.jsxs("div",{className:`grid gap-6 ${a.detail_resep.length>0&&a.detail_layanan.length>0?"md:grid-cols-2":"md:grid-cols-1"}`,children:[a.detail_resep.length>0&&e.jsx(A,{detail:a.detail_resep}),a.detail_layanan.length>0&&e.jsx(I,{detail:a.detail_layanan})]}),e.jsx(S,{detailResep:a.detail_resep,detailLayanan:a.detail_layanan,data:l,setData:s,processing:o,onSubmit:()=>c(!0)})]})}),e.jsx(j,{open:x,onOpenChange:c,children:e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(v,{children:"Konfirmasi Pembayaran"}),e.jsx(w,{children:"Apakah kamu yakin ingin memproses pembayaran ini?"})]}),e.jsxs(D,{children:[e.jsx(k,{disabled:o,children:"Batal"}),e.jsx(R,{onClick:r,disabled:o,className:"bg-emerald-600 hover:bg-emerald-700",children:"Ya, Proses Pembayaran"})]})]})})]})}export{B as default};

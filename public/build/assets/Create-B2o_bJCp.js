import{a as x,j as e,L as U,G as v,H as Y,t as f,r as w,s as G}from"./app-DPU-5xaA.js";import{H as y}from"./highlight-DUR8rx6z.js";import{C as W,a as q}from"./chevron-up-Crs5jcta.js";import{D as $}from"./data-pemeriksaan-fisik-DiKnpJ3n.js";import{A as C,b as A,c as S,d as L,e as T,f as F,g as P,h as B}from"./alert-dialog-C-ihqo6s.js";import{S as z}from"./switch-C1S3M_pS.js";import{A as J}from"./app-layout-i-Fpipg8.js";import{u as Q}from"./catatan-layanan.store-CO1wcFyV.js";import"./app-BZ19I5NX.js";import"./utils-C8uvsPt5.js";import"./index-BtRVbgEg.js";import"./app-logo-icon-xsYHPLvD.js";import"./index-DMEkJBJO.js";import"./x-DTHQ_Ru-.js";import"./index-4Ns3tNZl.js";const V=a=>{if(!a)return"-";const s=new Date(a);return isNaN(s.getTime())?"-":s.toLocaleDateString("id-ID")},X=a=>{if(!a)return"-";const s=new Date(a);if(isNaN(s.getTime()))return"-";const t=new Date;let o=t.getFullYear()-s.getFullYear();const m=t.getMonth()-s.getMonth();return(m<0||m===0&&t.getDate()<s.getDate())&&o--,`${o} tahun`},Z=({pasien:a})=>{const[s,t]=x.useState(!1);return e.jsx("div",{className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Informasi Pasien"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Data identitas pasien"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsx(y,{label:"Nomor Pasien",value:a.nomor_pasien}),e.jsx(_,{label:"Nama Lengkap",value:a.nama_lengkap}),e.jsx(_,{label:"Umur",value:X(a.tanggal_lahir)}),e.jsx(_,{label:"Tanggal Lahir",value:V(a.tanggal_lahir)}),s&&e.jsxs(e.Fragment,{children:[e.jsx(y,{label:"Golongan Darah",value:a.golongan_darah}),e.jsx(y,{label:"Riwayat Penyakit",value:a.riwayat_penyakit}),e.jsx(y,{className:"col-span-1 md:col-span-2",label:"Alergi",value:a.alergi,multiline:!0})]})]}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{type:"button",onClick:()=>t(!s),className:"inline-flex items-center text-sm text-emerald-600",children:s?e.jsxs(e.Fragment,{children:["Tampilkan Lebih Sedikit",e.jsx(W,{className:"ml-1 h-4 w-4"})]}):e.jsxs(e.Fragment,{children:["Tampilkan Lebih Banyak",e.jsx(q,{className:"ml-1 h-4 w-4"})]})})})]})})};function _({label:a,value:s}){return e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:a}),e.jsx("input",{disabled:!0,value:s,className:"w-full rounded-lg border border-gray-200 bg-gray-50 px-4 py-2.5 text-sm text-gray-700"})]})}function ee({punyaServer:a,butuhResep:s,data:t,setData:o,handleSubmit:m,processing:p,errors:r}){const d=u=>o(u.target.name,u.target.value);return e.jsxs("form",{onSubmit:m,className:"overflow-hidden rounded-lg border border-gray-200 bg-white shadow-sm",children:[e.jsxs("div",{className:"space-y-4 p-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Keluhan Utama"}),e.jsx("textarea",{readOnly:!0,rows:3,value:t.keluhan_utama||"-",className:"w-full cursor-not-allowed rounded-lg border border-gray-200 bg-gray-100 px-4 py-2.5 text-sm"})]}),a===1?e.jsxs("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Detail Keluhan"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{name:"detail_keluhan",value:t.detail_keluhan,onChange:d,rows:3,required:!0,placeholder:"Jelaskan lebih detail keluhan pasien",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),r.detail_keluhan&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.detail_keluhan})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Diagnosa ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"diagnosa",value:t.diagnosa,onChange:d,required:!0,placeholder:"Contoh: Gastritis, ISPA",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),r.diagnosa&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.diagnosa})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:["Tindakan ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",name:"tindakan",value:t.tindakan,onChange:d,required:!0,placeholder:"Contoh: Resep obat, Rujuk",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),r.tindakan&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.tindakan})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-gray-700",children:"Catatan Lain (Opsional)"}),e.jsx("textarea",{name:"catatan_lain",value:t.catatan_lain,onChange:d,rows:2,placeholder:"Catatan tambahan (opsional)",className:"w-full rounded-lg border border-gray-200 bg-white px-4 py-2.5 text-sm"}),r.catatan_lain&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.catatan_lain})]})]}):e.jsxs("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-6 text-center shadow-sm",children:[e.jsx("div",{className:"mx-auto mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-emerald-100",children:e.jsx("svg",{className:"h-6 w-6 text-emerald-600",fill:"none",stroke:"currentColor",strokeWidth:2,viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.79 1.732-3L13.732 4c-.77-1.79-2.502-1.79-3.268 0L3.34 16c-.77 1.79.192 3 1.732 3z"})})}),e.jsx("h3",{className:"mb-1 text-sm font-semibold text-emerald-800",children:"Mode Tanpa Server"}),e.jsx("p",{className:"text-sm text-emerald-700",children:"Data rekam medis lengkap dicatat secara manual. Informasi yang tersimpan otomatis hanya nomor pasien, nama, dan keluhan utama."})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 border-t bg-gray-50 px-6 py-4",children:[e.jsx(U,{href:"/dokter/antrian",className:"rounded-lg border px-4 py-2.5 text-sm",children:"Batal"}),e.jsx("button",{type:"submit",disabled:p,className:"rounded-lg bg-emerald-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-emerald-700 disabled:opacity-50",children:p?"Menyimpan...":s?"Siapkan Resep":"Simpan Tindakan"})]})]})}const ae=({layanan_list:a=[],onChange:s,errors:t={}})=>{const[o,m]=x.useState([]),p=n=>a.filter(l=>l.id===0||l.id===o[n]?.layanan_id||!o.some(i=>i.layanan_id===l.id)),r=()=>{m(n=>[...n,{layanan_id:0,nama_layanan:""}])},d=n=>{m(l=>l.filter((i,h)=>h!==n))},u=(n,l,i)=>{m(h=>{const g=[...h];return g[n]={...g[n],[l]:i},g})},c=(n,l)=>{const i=a.find(h=>h.id===l);i&&(u(n,"layanan_id",i.id),u(n,"nama_layanan",i.nama_layanan))};return x.useEffect(()=>{s(o)},[o]),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white shadow-sm",children:e.jsxs("div",{className:"space-y-6 p-6",children:[e.jsxs("div",{className:"space-y-4",children:[o.map((n,l)=>e.jsxs("div",{className:"rounded-lg border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["Layanan ke-",l+1]}),e.jsx("button",{type:"button",onClick:()=>d(l),className:"text-xs text-red-600 hover:underline",children:"Hapus"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-gray-700",children:"Layanan"}),e.jsxs("select",{value:n.layanan_id,onChange:i=>c(l,Number(i.target.value)),className:"w-full rounded-lg border px-3 py-2 text-sm",children:[e.jsx("option",{value:0,children:"-- Pilih Layanan --"}),p(l).map(i=>e.jsx("option",{value:i.id,children:i.nama_layanan},i.id))]})]})]},l)),e.jsx("button",{type:"button",onClick:r,className:"w-full rounded-lg border border-dashed border-gray-300 px-4 py-3 text-sm text-gray-600 hover:border-emerald-500 hover:text-emerald-600",children:"+ Tambah Layanan"})]}),t.general&&e.jsx("p",{className:"text-sm text-red-600",children:t.general})]})})},se=["Umum","Kebidanan & Kandungan","Anak","Kulit & Kelamin","Fisioterapi"];function je({pasien:a,klinik:s,antrian:t,punya_server:o,pemeriksaan_fisik:m,layanan:p}){const{data:r,setData:d,reset:u,setProcessing:c,setErrors:n,processing:l,errors:i}=Q(),[h,g]=v.useState(r.butuh_resep),[R,k]=v.useState(!1),[E,N]=v.useState(!1),D=!!s?.jenis_klinik&&se.includes(s.jenis_klinik);x.useEffect(()=>{u()},[]),x.useEffect(()=>{d("antrian_id",t.id),d("pasien_id",a.id),d("klinik_id",s.id),d("keluhan_utama",t.keluhan??""),D&&m&&d("pemeriksaan_fisik_id",m.id)},[t.id,a.id,s.id,m?.id]),x.useEffect(()=>{c(!1),n({})},[]),x.useEffect(()=>{d("butuh_resep",h)},[h]);const O=b=>{if(b.preventDefault(),!l){if(n({}),c(!0),!r.layanan.some(j=>j.layanan_id!==0)){n({general:"Pilih minimal 1 layanan untuk pasien."}),f.error("Pilih minimal 1 layanan untuk pasien."),c(!1);return}if(o===1){const j=I=>!String(I||"").trim();if(j(r.detail_keluhan)||j(r.diagnosa)||j(r.tindakan)){n({detail_keluhan:"Wajib diisi",diagnosa:"Wajib diisi",tindakan:"Wajib diisi"}),f.error("Lengkapi data rekam medis terlebih dahulu"),c(!1);return}}if(!h){N(!0),c(!1);return}k(!0),c(!1)}},K=()=>{k(!1),c(!0),w.visit(`/dokter/antrian/${t.id}/resep/create`)},M=()=>{N(!1),c(!0),w.post(G("dokter.resep.final-store"),{catatan:r},{onFinish:()=>c(!1),onSuccess:()=>{f.success("Tindakan berhasil disimpan"),w.visit("/dokter/antrian")},onError:b=>{f.error("Gagal menyimpan tindakan"),n(b)}})},H=[{title:"Daftar Antrian",href:"/dokter/antrian"},{title:"Buat Tindakan Dokter",href:""}];return e.jsxs(J,{breadcrumbs:H,children:[e.jsx(Y,{title:"Buat Tindakan Dokter"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-2xl font-semibold text-gray-900",children:["Buat Tindakan untuk ",a.nama_lengkap]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Buat tindakan yang akan dilakukan"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(Z,{pasien:a}),D&&m&&e.jsx($,{pemeriksaanFisik:m}),e.jsx(ae,{layanan_list:p??[],onChange:b=>d("layanan",b),errors:{general:i.general}}),e.jsx("div",{className:"rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900",children:["Resep Obat"," ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Apakah pasien memerlukan resep obat?"})]}),e.jsx(z,{className:"data-[state=checked]:bg-emerald-600",checked:h,onCheckedChange:g})]})}),e.jsx(ee,{punyaServer:o,butuhResep:h,data:r,setData:d,handleSubmit:O,processing:l,errors:i})]}),e.jsx(C,{open:R,onOpenChange:k,children:e.jsxs(A,{children:[e.jsxs(S,{children:[e.jsx(L,{children:o===0?"Apakah Anda sudah benar-benar mendata pasien ini?":"Apakah Anda sudah selesai mendata pasien ini?"}),e.jsx(T,{children:"Pastikan data pasien sudah sesuai sebelum menyimpan catatan layanan."})]}),e.jsxs(F,{children:[e.jsx(P,{children:"Batal"}),e.jsx(B,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:K,children:"Ya, lanjut ke resep"})]})]})}),e.jsx(C,{open:E,onOpenChange:N,children:e.jsxs(A,{children:[e.jsxs(S,{children:[e.jsx(L,{children:"Konfirmasi Simpan Tanpa Resep"}),e.jsxs(T,{children:["Anda memilih untuk"," ",e.jsx("strong",{className:"text-red-500",children:"tidak membuat resep"}),". Tindakan akan langsung disimpan dan pasien dianggap selesai. Yakin ingin melanjutkan?"]})]}),e.jsxs(F,{children:[e.jsx(P,{children:"Batal"}),e.jsx(B,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:M,children:"Ya, Simpan Tanpa Resep"})]})]})})]})]})}export{je as default};
